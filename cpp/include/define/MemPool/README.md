| 特性指标 | Bump Allocator | Free List | Bitmap Pool | Generation Pool | PMR Pool | TCMalloc | glibc malloc |
|---------|----------------|-----------|-------------|-----------------|----------|----------|--------------|
| **核心性能** |
| 分配速度 (cycles) | 2 | 5 (复用) / 2 (新) | 2-3 | 2 | 20-50 | 30-80 | 200-500 |
| 释放速度 (cycles) | 不支持 | 5 | 2 | 2 | 20-50 | 30-80 | 200-500 |
| 时间复杂度 | O(1) | O(1) | O(1) | O(1) | O(1) | O(1) 均摊 | O(log n) |
| 访问开销 (cycles) | 0 (裸指针) | 0 (裸指针) | 0 (裸指针) | 1 (版本检查) | 0 (裸指针) | 0 (裸指针) | 0 (裸指针) |
| **内存效率** |
| 内存回收 | ❌ 不回收 | ✅ 完全回收 | ✅ 完全回收 | ✅ 完全回收 | ✅ 完全回收 | ✅ 完全回收 | ✅ 完全回收 |
| 内存碎片率 | 0% (不回收) | <10% | 0% | <5% | <10% | 10-15% | 20-40% |
| 空间局部性 | 完美 | 差 (指针跳) | 极好 | 极好 | 好 | 一般 | 差 |
| 引用大小 (bytes) | 8 (指针) | 8 (指针) | 8 (指针) | 4 (handle) | 8 (指针) | 8 (指针) | 8 (指针) |
| **Cache 特性** |
| L1 访问次数 | 1 (load+store) | 2-3 (链表) | 2-3 (bitmap) | 2 (索引+槽位) | 3-5 | 4-8 | 10+ |
| Cache 命中率 | 极高 (100%) | 低 (随机跳) | 极高 (顺序) | 极高 (数组) | 高 | 中 | 低 |
| TLB 命中率 | 100% | 中高 | 高 | 高 | 高 | 中 | 低 |
| Prefetch 友好度 | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ |
| **CPU 流水线** |
| 分支预测数 | 0-1 | 2-3 | 2 | 2-3 | 3-5 | 4-6 | 10+ |
| 流水线停顿风险 | 极低 | 中 (指针追踪) | 低 (位操作) | 低 | 中 | 中高 | 高 |
| SIMD 加速潜力 | ✅ (批量分配) | ❌ | ✅ (并行扫描) | ✅ | ⚙️ | ⚙️ | ❌ |
| **并发特性** |
| 线程安全 | ❌ 单线程 | ⚙️ 需锁 | ⚙️ 原子位操作 | ⚙️ 需锁/版本 | ⚙️ 多池 | ✅ Lock-free | ⚙️ 多 arena |
| 跨线程回收 | 不适用 | 低效 | 中等 | 中等 | 高效 | 高效 | 高效 |
| False sharing 风险 | 低 | 中 | 低 (对齐) | 低 (对齐) | 中 | 中 | 高 |
| **调试与安全** |
| 悬垂指针检测 | ❌ | ❌ | ❌ | ✅ 自动 (gen) | ❌ | ❌ | ❌ |
| Double-free 检测 | ❌ | ⚙️ 需额外标记 | ⚙️ 位检查 | ✅ 自动 (gen) | ⚙️ | ✅ | ✅ |
| ABA 问题 | 无 | 有风险 | 无 | 免疫 (gen) | 无 | 无 | 无 |
| 内存泄漏检测 | 困难 | 中等 | 中等 | 容易 (gen 追踪) | 容易 | 容易 | 容易 |
| **实现细节** |
| 实现复杂度 | 极低 (10行) | 低 (50行) | 中 (100行) | 高 (200行) | 中 (STL) | 高 (5000+行) | 中 (STL) |
| 对齐控制 | 任意 | 固定 | 固定 | 固定 | 固定 | 多级 | 动态 |
| 构造/析构 Hook | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 批量操作支持 | ✅ 极快 | ⚙️ | ✅ | ✅ | ⚙️ | ⚙️ | ❌ |
| **适用场景** |
| 最佳场景 | 临时缓冲<br>批量分配<br>只增不删 | 中频增删<br>对象池<br>短生命周期 | 高频增删<br>固定容量<br>紧凑存储 | 需检测悬垂<br>Handle 优于指针<br>ECS 架构 | 通用哈希表<br>容器后端<br>快速开发 | 高并发服务<br>长时间运行<br>多线程 | 系统默认<br>通用场景 |
| LOB 应用建议 | Order 对象 | 不推荐 | HashMap Entry | Order (若需安全) | 哈希表节点 | 不适合 | 不适合 |
| **综合评分** |
| 极致性能场景 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ |
| 内存效率 | ⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ |
| 工程实用性 | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 调试友好度 | ⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
